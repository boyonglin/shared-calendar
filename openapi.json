{
  "openapi": "3.0.0",
  "info": {
    "title": "Shared Calendar API",
    "description": "Backend API for shared calendar application.",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:3001",
      "description": "Local Development Server"
    },
    {
      "url": "https://shared-calendar-vibe.vercel.app",
      "description": "Production Server"
    }
  ],
  "tags": [
    { "name": "Health" },
    { "name": "Authentication" },
    { "name": "Users" },
    { "name": "Calendar" },
    { "name": "Friends" },
    { "name": "AI" }
  ],
  "components": {
    "securitySchemes": {
      "cookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "token"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "email": { "type": "string", "format": "email" },
          "name": { "type": "string" },
          "picture": { "type": "string", "format": "uri" }
        },
        "example": {
          "id": "114123456789012345678",
          "email": "user@example.com",
          "name": "John Doe",
          "picture": "https://lh3.googleusercontent.com/a/example"
        }
      },
      "Event": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "summary": { "type": "string" },
          "description": { "type": "string" },
          "start": {
            "type": "object",
            "properties": {
              "dateTime": { "type": "string", "format": "date-time" },
              "date": { "type": "string", "format": "date" }
            }
          },
          "end": {
            "type": "object",
            "properties": {
              "dateTime": { "type": "string", "format": "date-time" },
              "date": { "type": "string", "format": "date" }
            }
          },
          "userId": { "type": "string" },
          "accountType": {
            "type": "string",
            "enum": ["google", "icloud", "outlook"]
          },
          "accountEmail": { "type": "string", "format": "email" },
          "friendConnectionId": { "type": "integer" }
        },
        "example": {
          "id": "abc123xyz",
          "summary": "Team Meeting",
          "start": { "dateTime": "2025-01-15T10:00:00+08:00" },
          "end": { "dateTime": "2025-01-15T11:00:00+08:00" },
          "userId": "114123456789012345678",
          "accountType": "google"
        }
      },
      "FriendConnection": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "userId": { "type": "string" },
          "friendEmail": { "type": "string", "format": "email" },
          "friendUserId": { "type": "string", "nullable": true },
          "friendName": { "type": "string" },
          "friendColor": { "type": "string" },
          "status": {
            "type": "string",
            "enum": ["pending", "requested", "incoming", "accepted"]
          },
          "createdAt": { "type": "string", "format": "date-time" }
        },
        "example": {
          "id": 1,
          "userId": "114123456789012345678",
          "friendEmail": "friend@example.com",
          "friendName": "Jane Smith",
          "status": "accepted"
        }
      },
      "Error": {
        "type": "object",
        "properties": {
          "error": { "type": "string" }
        },
        "example": { "error": "Invalid request" }
      },
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string" }
        },
        "example": { "success": true, "message": "Operation completed" }
      }
    }
  },
  "paths": {
    "/": {
      "get": {
        "tags": ["Health"],
        "operationId": "getServerRoot",
        "summary": "Server Root",
        "responses": {
          "200": {
            "description": "API info",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string" },
                    "version": { "type": "string" },
                    "status": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api": {
      "get": {
        "tags": ["Health"],
        "operationId": "getApiRoot",
        "summary": "API Root",
        "responses": {
          "200": {
            "description": "API info with endpoints list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string" },
                    "version": { "type": "string" },
                    "environment": { "type": "string" },
                    "endpoints": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/health": {
      "get": {
        "tags": ["Health"],
        "operationId": "getHealthCheck",
        "summary": "Health Check",
        "responses": {
          "200": {
            "description": "Server healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { "type": "string" },
                    "timestamp": { "type": "string", "format": "date-time" },
                    "checks": {
                      "type": "object",
                      "properties": { "database": { "type": "string" } }
                    }
                  }
                }
              }
            }
          },
          "503": {
            "description": "Server degraded",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/auth/google": {
      "get": {
        "tags": ["Authentication"],
        "operationId": "initiateGoogleAuth",
        "summary": "Initiate Google OAuth",
        "responses": {
          "302": { "description": "Redirect to Google OAuth" }
        }
      }
    },
    "/api/auth/google/callback": {
      "get": {
        "tags": ["Authentication"],
        "operationId": "handleGoogleCallback",
        "summary": "Google OAuth Callback",
        "parameters": [
          {
            "name": "code",
            "in": "query",
            "required": true,
            "schema": { "type": "string" }
          },
          { "name": "error", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "302": { "description": "Redirect to client with auth status" }
        }
      }
    },
    "/api/auth/exchange": {
      "post": {
        "tags": ["Authentication"],
        "operationId": "exchangeAuthCode",
        "summary": "Exchange Auth Code",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": { "code": { "type": "string" } },
                "required": ["code"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "userId": { "type": "string" },
                    "email": { "type": "string", "format": "email" },
                    "provider": { "type": "string" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid code",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/auth/me": {
      "get": {
        "tags": ["Authentication"],
        "operationId": "getCurrentUser",
        "summary": "Get Current User",
        "security": [{ "cookieAuth": [] }],
        "responses": {
          "200": {
            "description": "User info",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/User" }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/auth/icloud": {
      "post": {
        "tags": ["Authentication"],
        "operationId": "connectICloud",
        "summary": "Connect iCloud Calendar",
        "security": [{ "cookieAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string", "format": "email" },
                  "password": { "type": "string" }
                },
                "required": ["email", "password"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Connected",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": { "type": "string" },
                        "email": { "type": "string" }
                      }
                    },
                    "token": { "type": "string" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid format",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "401": {
            "description": "Auth failed",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/auth/outlook": {
      "get": {
        "tags": ["Authentication"],
        "operationId": "initiateOutlookAuth",
        "summary": "Initiate Outlook OAuth",
        "security": [{ "cookieAuth": [] }],
        "responses": {
          "302": { "description": "Redirect to OneCal OAuth" },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/auth/outlook/callback": {
      "get": {
        "tags": ["Authentication"],
        "operationId": "handleOutlookCallback",
        "summary": "Outlook OAuth Callback",
        "parameters": [
          {
            "name": "endUserAccountId",
            "in": "query",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "302": { "description": "Redirect to client" },
          "400": {
            "description": "Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/auth/revoke": {
      "delete": {
        "tags": ["Authentication"],
        "operationId": "revokeAccount",
        "summary": "Revoke Account",
        "security": [{ "cookieAuth": [] }],
        "responses": {
          "200": {
            "description": "Revoked",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SuccessResponse" }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/users/{id}": {
      "get": {
        "tags": ["Users"],
        "operationId": "getUserProfile",
        "summary": "Get User Profile",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "User profile",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/User" }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/calendar/all-events/{primaryUserId}": {
      "get": {
        "tags": ["Calendar"],
        "operationId": "getAllEvents",
        "summary": "Fetch All Events",
        "security": [{ "cookieAuth": [] }],
        "parameters": [
          {
            "name": "primaryUserId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          },
          {
            "name": "timeMin",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" }
          },
          {
            "name": "timeMax",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" }
          }
        ],
        "responses": {
          "200": {
            "description": "Events list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Event" }
                }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/calendar/events-stream/{primaryUserId}": {
      "get": {
        "tags": ["Calendar"],
        "operationId": "streamEvents",
        "summary": "Stream Events (SSE)",
        "security": [{ "cookieAuth": [] }],
        "parameters": [
          {
            "name": "primaryUserId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          },
          {
            "name": "timeMin",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" }
          },
          {
            "name": "timeMax",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" }
          }
        ],
        "responses": {
          "200": {
            "description": "SSE stream",
            "content": {
              "text/event-stream": { "schema": { "type": "string" } }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/calendar/{userId}/events": {
      "get": {
        "tags": ["Calendar"],
        "operationId": "getUserEvents",
        "summary": "Get User Events",
        "security": [{ "cookieAuth": [] }],
        "parameters": [
          {
            "name": "userId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          },
          {
            "name": "timeMin",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" }
          },
          {
            "name": "timeMax",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" }
          }
        ],
        "responses": {
          "200": {
            "description": "Events list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Event" }
                }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "403": {
            "description": "Not authorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/calendar/events": {
      "post": {
        "tags": ["Calendar"],
        "operationId": "createEvent",
        "summary": "Create Event",
        "security": [{ "cookieAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": { "type": "string", "maxLength": 200 },
                  "description": { "type": "string" },
                  "start": { "type": "string", "format": "date-time" },
                  "end": { "type": "string", "format": "date-time" },
                  "attendees": {
                    "type": "array",
                    "items": { "type": "string", "format": "email" }
                  },
                  "isAllDay": { "type": "boolean" }
                },
                "required": ["title", "start", "end"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Event" }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "501": {
            "description": "Not supported",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/calendar/icloud/status": {
      "get": {
        "tags": ["Calendar"],
        "operationId": "getICloudStatus",
        "summary": "Get iCloud Status",
        "security": [{ "cookieAuth": [] }],
        "responses": {
          "200": {
            "description": "Status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "connected": { "type": "boolean" },
                    "email": { "type": "string" },
                    "userId": { "type": "string" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/calendar/icloud/{userId}": {
      "delete": {
        "tags": ["Calendar"],
        "operationId": "disconnectICloud",
        "summary": "Disconnect iCloud",
        "security": [{ "cookieAuth": [] }],
        "parameters": [
          {
            "name": "userId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Disconnected",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SuccessResponse" }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/calendar/outlook/status": {
      "get": {
        "tags": ["Calendar"],
        "operationId": "getOutlookStatus",
        "summary": "Get Outlook Status",
        "security": [{ "cookieAuth": [] }],
        "responses": {
          "200": {
            "description": "Status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "connected": { "type": "boolean" },
                    "email": { "type": "string" },
                    "userId": { "type": "string" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/calendar/outlook/{userId}": {
      "delete": {
        "tags": ["Calendar"],
        "operationId": "disconnectOutlook",
        "summary": "Disconnect Outlook",
        "security": [{ "cookieAuth": [] }],
        "parameters": [
          {
            "name": "userId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Disconnected",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SuccessResponse" }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/friends": {
      "get": {
        "tags": ["Friends"],
        "operationId": "listFriends",
        "summary": "List Friends",
        "security": [{ "cookieAuth": [] }],
        "responses": {
          "200": {
            "description": "Friend list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "friends": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/FriendConnection"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Friends"],
        "operationId": "addFriend",
        "summary": "Add Friend",
        "security": [{ "cookieAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "friendEmail": { "type": "string", "format": "email" }
                },
                "required": ["friendEmail"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Request sent",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "connection": {
                      "$ref": "#/components/schemas/FriendConnection"
                    },
                    "message": { "type": "string" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/friends/sync-pending": {
      "post": {
        "tags": ["Friends"],
        "operationId": "syncPendingFriends",
        "summary": "Sync Pending Friends",
        "security": [{ "cookieAuth": [] }],
        "responses": {
          "200": {
            "description": "Synced",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "message": { "type": "string" },
                    "updatedCount": { "type": "integer" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/friends/{friendId}": {
      "delete": {
        "tags": ["Friends"],
        "operationId": "removeFriend",
        "summary": "Remove Friend",
        "security": [{ "cookieAuth": [] }],
        "parameters": [
          {
            "name": "friendId",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "Removed",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SuccessResponse" }
              }
            }
          },
          "400": {
            "description": "Invalid ID",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/friends/requests/incoming": {
      "get": {
        "tags": ["Friends"],
        "operationId": "getIncomingRequests",
        "summary": "Get Incoming Requests",
        "security": [{ "cookieAuth": [] }],
        "responses": {
          "200": {
            "description": "Incoming requests",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "requests": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/FriendConnection"
                      }
                    },
                    "count": { "type": "integer" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/friends/{friendId}/accept": {
      "post": {
        "tags": ["Friends"],
        "operationId": "acceptFriendRequest",
        "summary": "Accept Friend Request",
        "security": [{ "cookieAuth": [] }],
        "parameters": [
          {
            "name": "friendId",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "Accepted",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SuccessResponse" }
              }
            }
          },
          "400": {
            "description": "Invalid ID",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/friends/{friendId}/reject": {
      "post": {
        "tags": ["Friends"],
        "operationId": "rejectFriendRequest",
        "summary": "Reject Friend Request",
        "security": [{ "cookieAuth": [] }],
        "parameters": [
          {
            "name": "friendId",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "Rejected",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SuccessResponse" }
              }
            }
          },
          "400": {
            "description": "Invalid ID",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/friends/{friendId}/events": {
      "get": {
        "tags": ["Friends"],
        "operationId": "getFriendEvents",
        "summary": "Get Friend's Events",
        "security": [{ "cookieAuth": [] }],
        "parameters": [
          {
            "name": "friendId",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          },
          {
            "name": "timeMin",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" }
          },
          {
            "name": "timeMax",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" }
          }
        ],
        "responses": {
          "200": {
            "description": "Friend's events",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "events": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Event" }
                    },
                    "errors": { "type": "array", "items": { "type": "object" } }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/api/ai/draft-invitation": {
      "post": {
        "tags": ["AI"],
        "operationId": "draftInvitation",
        "summary": "Draft Invitation with AI",
        "security": [{ "cookieAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": { "type": "string", "maxLength": 200 },
                  "description": { "type": "string", "maxLength": 2000 },
                  "start": { "type": "string", "format": "date-time" },
                  "end": { "type": "string", "format": "date-time" },
                  "attendees": {
                    "type": "array",
                    "maxItems": 50,
                    "items": { "type": "string" }
                  },
                  "location": { "type": "string" },
                  "tone": {
                    "type": "string",
                    "enum": ["professional", "casual", "friendly"]
                  },
                  "geminiApiKey": { "type": "string" }
                },
                "required": ["title", "start", "end", "geminiApiKey"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Draft generated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": { "draft": { "type": "string" } }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "401": {
            "description": "Not authenticated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "500": {
            "description": "AI error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    }
  }
}
